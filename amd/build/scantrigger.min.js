define("plagiarism_origai/scantrigger",["exports","core/config"],(function(_exports,config){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,config=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(config);_exports.init=()=>{const startPolling=pollElement=>{const pollId=pollElement.getAttribute("data-plagiarism_origa-poll-scanid"),pollInterval=parseInt(pollElement.getAttribute("data-plagiarism_origa-poll-interval"),10)||5e3,cmid=pollElement.getAttribute("data-plagiarism_origa-cmid"),coursemodule=pollElement.getAttribute("data-plagiarism_origa-coursemodule"),sesskey=pollElement.getAttribute("data-plagiarism_origa-sesskey"),pollsearchparam=new URLSearchParams({scanid:pollId,returnurl:window.location.href,cmid:cmid,coursemodule:coursemodule,sesskey:sesskey}),pollUrl="".concat(config.wwwroot,"/plagiarism/origai/poll_scan.php?").concat(pollsearchparam.toString()),pollIntervalId=setInterval((()=>{fetch(pollUrl,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((response=>response.json())).then((data=>("completed"===data.status&&(clearInterval(pollIntervalId),pollElement.outerHTML=data.renderhtml),data))).catch((error=>{console.error("Polling error:",error)}))}),pollInterval)};setTimeout((()=>{document.querySelectorAll("[data-plagiarism_origa-poll-scanid]").forEach((pollAction=>{startPolling(pollAction)}))}),500),document.body.addEventListener("click",(function(event){const target=event.target.closest("[data-plagiarism_origa-trigger-scanid]");if(target&&"A"==target.tagName){if(event.preventDefault(),!(target instanceof HTMLAnchorElement))return void console.warn("Target is not an anchor element");const url=new URL(target.href),cmid=url.searchParams.get("cmid"),coursemodule=url.searchParams.get("coursemodule"),sesskey=url.searchParams.get("sesskey"),returnurl=url.searchParams.get("returnurl"),scantype=url.searchParams.get("scantype"),scanId=target.getAttribute("data-plagiarism_origa-trigger-scanid"),scanUrl="".concat(config.wwwroot,"/plagiarism/origai/scan_content.php"),bodyParams={scanid:scanId,isasync:1,cmid:cmid,coursemodule:coursemodule,sesskey:sesskey,returnurl:returnurl};fetch(scanUrl+"?"+new URLSearchParams(bodyParams),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(bodyParams)}).then((response=>response.json())).then((data=>{target.outerHTML=data.renderhtml,"success"===data.status&&requestAnimationFrame((()=>{const newPollEl=document.querySelector('[data-plagiarism_origa-poll-scanid="'.concat(scanId,'"]'));newPollEl?startPolling(newPollEl):config.display&&console.warn("No poll element found after scan trigger for scanId:",scanId)}))})).catch((()=>{target.outerHTML='\n                    <div class="origai-section">\n                        <h3 class="origai-section-title">'.concat("ai"===scantype?"AI Check":"Plagiarism Check",'</h3>\n                        <div class="d-flex align-items-center text-danger">\n                            <i class="fa fa-exclamation-circle me-2"\n                                title="Scan failed" aria-label="Scan failed" data-toggle="tooltip"></i>\n                            Scan failed\n                        </div>\n                    </div>')}))}}))}}));

//# sourceMappingURL=scantrigger.min.js.map